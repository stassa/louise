:-module(grid_master_configuration, [action/1
                                    ,action_representation/1
                                    ,action_order/1
                                    ,action_symbol/4
                                    ,display_engine/1
                                    ,maps_module/1
                                    ,map_file/1
                                    ,observation_matrices/1
                                    ,passable/1
                                    ,primitives_file/2
                                    ,state_mapping/2
                                    ,test_primitives_file/2
                                    ,theme/1
                                    ,tile/4
                                    ,tile_alias/2
                                    ]).

/** <module> Configuration options for Grid Master.

*/
:-dynamic action/1
         ,action_representation/1
         ,observation_matrices/1
         ,primitives_file/2
         ,theme/1.


%!      action(?Name) is semidet.
%
%       The Name of an action to generate a definition for.
%
%       Used by action_generator module to choose what actions
%       to generate.
%
%action(set_course_up).
%action(set_course_up_right).
%action(set_course_right).
%action(set_course_down_right).
%action(set_course_down).
%action(set_course_down_left).
%action(set_course_left).
%action(set_course_up_left).
action(step_up).
action(step_up_right).
action(step_right).
action(step_down_right).
action(step_down).
action(step_down_left).
action(step_left).
action(step_up_left).
%action(look_up).
%action(look_up_right).
%action(look_right).
%action(look_down_right).
%action(look_down).
%action(look_down_left).
%action(look_left).
%action(look_up_left).


%!      action_order(?Order) is semidet.
%
%       The order in which action predicates are generated.
%
%       Order is one of:
%       * unsorted: actions are generated according to the order of
%         action/1 clauses.
%       * sorted: actions are generated in lexicographic order (i.e.
%         sorted in the standard order of terms).
%
action_order(unsorted).
%action_order(sorted).


%!      action_representation(?Representation) is semidet.
%
%       Whether the state vector will have an action-stack or not.
%
%       Currently known representations:
%       * stack_based: the state vector has an action stack where action
%       tokens are pushed to each time an action is taken.
%       * memoryless: the state vector has no action stack.
%
%action_representation(list_based).
%action_representation(stack_less).
%action_representation(stack_based).
%action_representation(lookaround).
action_representation(controller_sequences).


%!      action_symbol(?Type,?Direction,?Action,?Symbol) is semidet.
%
%       Mapping between directional actions and symbols.
%
%       Type is the type of directional action, one of: [step, look].
%
%       Direction is one of the eight grid world directions: [up,
%       up_right, right, down_right, down, down_left, left, up_left].
%
%       Action is the name of the action that corresponds to Type and
%       Direction defined either as a dyadic Solver action predicate, or
%       a Controller action label.
%
%       Symbol is an atomic, single-character symbol used to represent
%       the action graphically as a cell on a grid.
%
%       The motivation for this setting is to allow a uniform
%       representation of actions and their names and grid symbols
%       throughout the grid_master library.
%
action_symbol(step,up,step_up,u).
action_symbol(step,up_right,step_up_right,t).
action_symbol(step,right,step_right,r).
action_symbol(step,down_right,step_down_right,n).
action_symbol(step,down,step_down,d).
action_symbol(step,down_left,step_down_left,z).
action_symbol(step,left,step_left,l).
action_symbol(step,up_left,step_up_left,q).
% Look actions.
action_symbol(look,up,look_up,8).
action_symbol(look,up_right,look_up_right,9).
action_symbol(look,right,look_right,6).
action_symbol(look,down_right,look_down_right,3).
action_symbol(look,down,look_down,2).
action_symbol(look,down_left,look_down_left,1).
action_symbol(look,left,look_left,4).
action_symbol(look,up_left,look_up_left,7).


%!      display_engine(?Engine) is semidet.
%
%       The display Engine to use in map_display.
%
%       @tbd Not currently used.
%
display_engine(prolog).
%display_engine(python).


%!      maps_module(?Module) is semidet.
%
%       Name of the module storing map/3 terms.
%
maps_module(maps).


:-multifile(map_file/1).

%!      map_file(?Path) is semidet.
%
%       Path loading generated maze maps.
%
%       Path should be the path to a Prolog file with load directives
%       for the mazes generated by James' map generator (or any other
%       generator we end up using).
%
%       That file is loaded to import the generated maps into the
%       move_generator module, from where they are combined with
%       primitive moves and written to a new file, defined in
%       primitives_file/1.
%
map_file(grid_master_data(maps/'zero.map')).
map_file(grid_master_data(maps/'tessera_1.map')).
map_file(grid_master_data(maps/'tessera_2.map')).
map_file(grid_master_data(maps/'tessera_3.map')).
map_file(grid_master_data(maps/'tessera_4.map')).
map_file(grid_master_data(maps/'test_1.map')).
map_file(grid_master_data(maps/'room.map')).
map_file(grid_master_data(maps/'big_room.map')).
map_file(grid_master_data(maps/'hall_a.map')).
map_file(grid_master_data(maps/'hall_a_small.map')).
% Dungeon maps
map_file(grid_master_data(dungeons/'dungeon_1.map')).
map_file(grid_master_data(dungeons/'dungeon_2.map')).
map_file(grid_master_data(dungeons/'dungeon_3.map')).
map_file(grid_master_data(dungeons/'dungeon_4.map')).
map_file(grid_master_data(dungeons/'dungeon_5.map')).
map_file(grid_master_data(dungeons/'dungeon_6.map')).
map_file(grid_master_data(dungeons/'dungeon_7.map')).
map_file(grid_master_data(dungeons/'dungeon_8.map')).
map_file(grid_master_data(dungeons/'dungeon_9.map')).
map_file(grid_master_data(dungeons/'dungeon_10.map')).
map_file(grid_master_data(dungeons/'dungeon_small.map')).


%!      observation_matrices(?Type) is semidet.
%
%       The Type of observation matrices to generate.
%
%       One of: four_way, eight_way, denoting the number of directions
%       to look-to when generating observation matrices.
%
observation_matrices(four_way).
%observation_matrices(eight_way).


%!      passable(?Symbol) is semidet.
%
%       Symbol of a passable tile in a map.
%
%       Passable tiles can be traversed by an agent. Other tiles,
%       cannot.
%
passable(f).
passable(s).
passable(e).
passable(u).
passable(r).
passable(d).
passable(l).
%passable(x).
passable(@). % Traversing
passable(a). % Patrolling landmark A
passable(b). % Patrolling landmark B
passable(c). % Patrolling landmark C
passable(g). % Patrolling landmark D


%!      primitives_file(?Path,?Module) is semidet.
%
%       Path to the Prolog Module holding primitive moves and maze maps.
%
%primitives_file(grid_master_data('primitives.pl'),primitives).
%primitives_file(grid_master_data('primitives_stack_less.pl'),primitives).
%primitives_file(grid_master_data('primitives_stack_based.pl'),primitives).
%primitives_file(grid_master_data('primitives_lookaround.pl'),primitives).
primitives_file(grid_master_data('primitives_controller_sequences.pl'),primitives).
%primitives_file(grid_master_data('primitives_list_based.pl'),primitives).
%primitives_file(grid_master_data('primitives_observation_matrices.pl'),primitives).
%primitives_file(grid_master_data('primitives_8w_observation_matrices.pl'),primitives).
%primitives_file(grid_master_data('primitives_ordered.pl'),primitives).
%primitives_file(grid_master_data('observation_matrices_ordered.pl'),primitives).


%!      state_mapping(?Action,?State) is semidet.
%
%       Mapping between Action and State labels.
%
%       Completely arbitrary and set according to application needs.
%
%       @tbd Maybe also allow mapping of State label to Observation
%       label?
%
% Step actions (4-way controller):
state_mapping(step_up,q0).
state_mapping(step_right,q1).
state_mapping(step_down,q2).
state_mapping(step_left,q3).
% Step actions (8-way controller)
%state_mapping(step_up,q0).
%state_mapping(step_up_right,q1).
%state_mapping(step_right,q2).
%state_mapping(step_down_right,q3).
%state_mapping(step_down,q4).
%state_mapping(step_down_left,q5).
%state_mapping(step_left,q6).
%state_mapping(step_up_left,q7).
% Look actions:
state_mapping(look_up,q0).
state_mapping(look_up_right,q1).
state_mapping(look_right,q2).
state_mapping(look_down_right,q3).
state_mapping(look_down,q4).
state_mapping(look_down_left,q5).
state_mapping(look_left,q6).
state_mapping(look_up_left,q7).


%!      test_primitives_file(?Path,?Module) is semidet.
%
%       Path and Module name for a file with primitives for testing.
%
test_primitives_file(grid_master_data('test_primitives.pl'),primitives).


%!      theme(?Theme) is semidet.
%
%       Theme for map and path printing.
%
%       Known themes:
%
%       * text: prints map in coloured text characters.
%       * boxes: prints map in coloured box drawings.
%
%       Example of 'text' theme (without the colours):
%       ==
%       ?- map_display:theme(T).
%       T = text.
%
%       ?- trace_path(0).
%       ˅ w f f f f f
%       ˅ w w w f w w
%       ˃ ˃ ˅ w f f f
%       w w ˅ w w w f
%       f w ˃ ˃ ˃ ˃ ˅
%       f w w w w w ˅
%       f f f f f f e
%       true.
%       ==
%
%       % Example of 'boxes' theme (without the colours):
%       ==
%       ?- map_display:theme(T).
%       T = boxes.
%
%       ?- trace_path(0).
%       ▼ ■ □ □ □ □ □
%       ▼ ■ ■ ■ □ ■ ■
%       ► ► ▼ ■ □ □ □
%       ■ ■ ▼ ■ ■ ■ □
%       □ ■ ► ► ► ► ▼
%       □ ■ ■ ■ ■ ■ ▼
%       □ □ □ □ □ □ █
%       true.
%       ==
%
%theme(text).
theme(boxes).


%!      tile(?Token,?Theme,?Style,?Symbol) is semidet.
%
%       Mapping between tiles and their printing elements.
%
%       Token is the symbol of a tile, or a primitive move.
%
%       Theme is the atomic identifier of a printing theme, as defined
%       in theme/1.
%
%       Style is a list of attributes passed to the second
%       argument of ansi_format/3, that determines how Tile will be
%       printed by print_tile/4.
%
%       Symbol is the symbol to be printed. This allows arbitrary
%       mapping between the representation of map tiles and move
%       symbols, and printing characters.
%
tile(s,text,[fg(cyan)],s).
tile(f,text,[fg(green)],f).
tile(w,text,[fg(red)],w).
tile(e,text,[bold,fg(green)],e).
tile(@,text,[fg(yellow)],@).
tile(u,text,[fg(yellow)],˄).
tile(d,text,[fg(yellow)],˅).
tile(r,text,[fg(yellow)],˃).
tile(l,text,[fg(yellow)],˂).
% Missing diagonal moves.
tile(x,text,[fg('#808080')],x).
tile(a,text,[bold,fg(yellow)],'A'). % Patrolling landmark
tile(b,text,[bold,fg(yellow)],'B'). % Patrolling landmark
tile(c,text,[bold,fg(yellow)],'C'). % Patrolling landmark
tile(g,text,[bold,fg(yellow)],'D'). % Patrolling landmark
tile(?,text,[bold,fg('#808080')],.). % Patrolling middle area
% ASCII box drawings
%tile(s,boxes,[fg(cyan)],█).
tile(s,boxes,[fg(cyan)],'S').
tile(f,boxes,[fg(green)],□).
tile(w,boxes,[fg(red)],■).
%tile(e,boxes,[bold,fg(green)],█).
tile(e,boxes,[bold,fg(green)],'E').
tile(@,boxes,[bold,fg(yellow)],@).
tile(u,boxes,[bold,fg(yellow)],▲).
tile(d,boxes,[bold,fg(yellow)],▼).
tile(r,boxes,[bold,fg(yellow)],►).
tile(l,boxes,[bold,fg(yellow)],◄).
% Diagonal move actions. Need right font, e.g. DejaVu Mono.
tile(t,boxes,[bold,fg(yellow)],◥). % up-right
tile(n,boxes,[bold,fg(yellow)],◢). % down-right
tile(z,boxes,[bold,fg(yellow)],◣). % down-left
tile(q,boxes,[bold,fg(yellow)],◤). % up-left
tile(x,boxes,[bold,fg('#808080')],.).
tile(a,boxes,[bold,fg(yellow)],'A'). % Patrolling landmark
tile(b,boxes,[bold,fg(yellow)],'B'). % Patrolling landmark
tile(c,boxes,[bold,fg(yellow)],'C'). % Patrolling landmark
tile(g,boxes,[bold,fg(yellow)],'D'). % Patrolling landmark
tile(?,boxes,[bold,fg('#808080')],.). % Patrolling middle area
tile('X',boxes,[bold,fg(yellow)],'X').


%!      tile_alias(?Tile,?Alias) is semidet.
%
%       An Alias for a Tile.
%
%       Used to translate input maps to a desired notation. Only
%       applies when loading a map from a file.
%
tile_alias(#,w).
tile_alias(.,f).
%tile_alias(.,&).
